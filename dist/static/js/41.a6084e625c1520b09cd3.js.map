{"version":3,"sources":["webpack:///src/views/display-data/DisplayData 2.vue","webpack:///./src/views/display-data/DisplayData 2.vue?8723","webpack:///./src/views/display-data/DisplayData 2.vue"],"names":["DisplayData_2","DataItem","_this","this","which","focus","current_page","get_history","api","get","params","page_size","has_read_perms","then","response","results","catch","error","save_history","select","query_string","history","filter","filter_function","value","username","all_history","table","search_data","indices","query","page","_this2","source","post","width","succeeded_callback","_this3","current_query","current_indices","val","_this4","name","$c_master","id","data","$mount","$el","display_data_DisplayData_2","render","_vm","_h","$createElement","_c","_self","ref","staticStyle","attrs","autofocus","is_focus","trigger-on-focus","suffix-icon","search_input_icon","fetch-suggestions","history_filter","select-when-unmatched","placeholder","on","on_focus","nativeOn","keyup","$event","_k","keyCode","key","on_search","model","callback","$$v","expression","slot","multiple","filterable","default-first-option","_l","item","padding","display","align-items","justify-content","label","_v","_s","icon","click","stopPropagation","on_add_data","on_show_info","loading","directives","rawName","border","margin","overflow-x","_id","delete_data","float","margin-right","background","layout","page-size","total","total_num","current-page","update:currentPage","current-change","on_page_change","staticRenderFns","Component","__webpack_require__","normalizeComponent","__webpack_exports__"],"mappings":"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","file":"static/js/41.a6084e625c1520b09cd3.js","sourcesContent":["<template>\n  <div>\n    <div>\n      <el-autocomplete id=\"search_input\" ref=\"search_input\" :autofocus=\"is_focus\" :trigger-on-focus=\"false\" :suffix-icon=\"search_input_icon\" @focus=\"on_focus\" :fetch-suggestions=\"history_filter\" select-when-unmatched @keyup.enter.native=\"on_search()\" placeholder=\"示例：(hostname:huawei* AND price:[20000 TO 40000]) 更多请参阅Lucene语法\" v-model=\"query\" style=\"width: 100%\">\n        <el-select v-model=\"indices\" style=\"width: 250px\" slot=\"prepend\" multiple filterable default-first-option placeholder=\"选择表 默认：all\">\n          <el-option style=\"padding: 10px; display: flex; align-items: center; justify-content: space-between\" v-for=\"item in tables\" :key=\"item.id\" :label=\"item.name\" :value=\"item.name\">\n            <span>{{ item.name }}</span>\n            <div>\n              <el-button style=\"padding: 0px\" icon=\"el-icon-circle-plus\" @click.stop=\"on_add_data(item)\"></el-button>\n              <el-button style=\"padding: 0px\" icon=\"el-icon-info\" @click.stop=\"on_show_info(item)\"></el-button>\n            </div>\n          </el-option>\n        </el-select>\n        <el-button id=\"submit\" @click=\"on_search()\" slot=\"append\" icon=\"el-icon-search\" :loading=\"loading\"></el-button>\n      </el-autocomplete>\n    </div>\n    <div style=\"border: 1px #DCDFE6 solid; margin: 10px 0px; width: 100%; overflow-x: auto\" v-loading=\"loading\">\n      <data-item v-for=\"item in data\" :data=\"item\" :key=\"item._id\" v-on:delete_data=\"delete_data\"></data-item>\n    </div>\n    <el-pagination style=\"float: right; margin-right: 100px;\" background layout=\"total, prev, pager, next\" :page-size=\"page_size\" :total=\"total_num\" :current-page.sync=\"current_page\" @current-change=\"on_page_change\">\n    </el-pagination>\n  </div>\n</template>\n\n<script>\nimport Vue from \"vue\";\nimport DataItem from \"./components/DataItem.vue\";\nimport master from \"@/api\";\nimport axios from \"axios\";\n\nexport default {\n  name: \"DisplayData\",\n  components: {\n    DataItem\n  },\n  data: () => {\n    return {\n      data: [],\n      query: \"\",\n      tables: [],\n      loading: false,\n      current_query: \"*\",\n      indices: [],\n      current_indices: [],\n      page: 1,\n      page_size: 0,\n      last_source: null,\n      search_input_icon: \"el-icon-edit\",\n      page_num: 0,\n      current_page: 1,\n      total_num: 0,\n      all_history: {},\n      username: \"\",\n      history: [],\n      is_focus: true,\n      table_dict: {}\n    };\n  },\n  mounted() {\n    var self = this;\n    document.onkeydown = function(e) {\n      var keyNum = window.event ? e.keyCode : e.which;\n      if (73 == e.keyCode && e.ctrlKey) {\n        self.$refs.search_input.focus();\n      } else if (78 == e.keyCode && e.ctrlKey) {\n        if (self.current_page * self.page_size >= self.total_num) {\n          self.$message.warning(\"已在末页\");\n          return;\n        }\n        self.current_page += 1;\n        self.on_page_change(self.current_page);\n      } else if (80 == e.keyCode && e.ctrlKey) {\n        if (self.current_page == 1) {\n          self.$message.warning(\"已在首页\");\n          return;\n        }\n        self.current_page -= 1;\n        self.on_page_change(self.current_page);\n      }\n    };\n    var page_size = Math.floor((window.innerHeight - 170) / 44);\n    this.page_size = page_size > 8 ? page_size : 8;\n    this.get_history();\n    master\n      .get(\"mgmt/table\", { params: { page_size: 100, has_read_perms: true } })\n      .then(response => {\n        this.tables = response.data.results;\n      })\n      .catch(error => {});\n    this.search_data([], \"*\", 1, this.page_size);\n  },\n  destroyed() {\n    this.save_history();\n  },\n  methods: {\n    on_focus(event) {\n      console.log(\"on_focus\");\n      event.currentTarget.select();\n    },\n    history_filter(query_string, cb) {\n      console.log(\"query_string:\", query_string);\n      var values = query_string\n        ? this.history.filter(this.filter_function(query_string))\n        : this.history;\n      var results = [];\n      values.map(value => {\n        results.push({ value });\n      });\n      console.log(\"results:\", results);\n      cb(results);\n    },\n    filter_function(query_string) {\n      return value => {\n        return value.toLowerCase().indexOf(query_string.toLowerCase()) != -1;\n      };\n    },\n    get_history() {\n      var all_history = JSON.parse(localStorage.getItem(\"history\"));\n      if (all_history) {\n        var username = this.$store.state.username;\n        if (!username) {\n          return;\n        }\n        this.username = username;\n        this.all_history = all_history;\n        this.history = all_history[username] ? all_history[username] : [];\n      }\n    },\n    save_history() {\n      this.all_history[this.username] = this.history.splice(0, 100);\n      localStorage.setItem(\"history\", JSON.stringify(this.all_history));\n    },\n    add_data(table) {\n      console.log(\"table:\", table);\n    },\n    search_data(\n      indices,\n      query,\n      page,\n      page_size,\n      reset_page = false,\n      succeeded_callback = null\n    ) {\n      if (this.last_source) {\n        // this.last_source.cancel()\n      }\n      var source = axios.CancelToken.source();\n      this.last_source = source;\n      var self = this;\n      this.search_input_icon = \"el-icon-loading\";\n      this.loading = true;\n      master\n        .post(\"search/data-lucene\", { indices, query, page, page_size, width: true})\n        .then(response => {\n          this.loading = false;\n          self.data = response.data[\"hits\"];\n          this.total_num = response.data[\"total\"];\n          this.search_input_icon = \"el-icon-edit\";\n          this.page_num = Math.ceil(response.data.total / this.page_size);\n          if (reset_page) {\n            this.current_page = 1;\n          }\n          if (succeeded_callback) {\n            succeeded_callback();\n          }\n        })\n        .catch(error => {\n          this.loading = false;\n          this.search_input_icon = \"el-icon-edit\";\n        });\n    },\n    on_search() {\n      const succeeded_callback = () => {\n        this.current_query = this.query;\n        this.current_indices = this.indices;\n      };\n      if (\n        this.current_query == this.query &&\n        this.current_indices == this.indices\n      ) {\n        this.$message.warning(\"重复搜索\");\n        return;\n      }\n      if (this.query == \"\") {\n        this.query = \"*\";\n      }\n      this.is_focus = false;\n      if (!this.history.includes(this.query)) {\n        this.history.unshift(this.query);\n      }\n      this.page = 1;\n      this.search_data(\n        this.indices,\n        this.query,\n        1,\n        this.page_size,\n        true,\n        succeeded_callback\n      );\n      document.getElementById(\"submit\").focus();\n    },\n    on_page_change(val) {\n      console.log(\"val:\", val);\n      this.current_page = val;\n      this.search_data(\n        this.current_indices,\n        this.current_query,\n        val,\n        this.page_size\n      );\n    },\n    delete_data(data) {\n      this.data.splice(this.data.indexOf(data), 1);\n      this.total_num -= 1;\n    },\n    on_add_data(table) {\n      // var AddData = Vue.component(\"AddData\");\n      // var vm = new AddData({ propsData: { table_name: table.name } });\n      // vm.$mount();\n      // this.$el.appendChild(vm.$el);\n      var vm = this.$c_add_dialog(this, \"AddData\", { table_name: table.name });\n      vm.$on(\"add_item\", id => {\n        this.$c_master\n          .get(`data/${table.name}/${id}`)\n          .then(response => {\n            this.data.unshift(response.data);\n          })\n          .catch(error => {});\n      });\n    },\n    on_show_info(table) {\n      var ShowTable = Vue.component(\"ShowTable\");\n      var vm = new ShowTable({ propsData: { table } });\n      vm.$mount();\n      this.$el.appendChild(vm.$el);\n    }\n  }\n};\n</script>\n\n\n\n// WEBPACK FOOTER //\n// src/views/display-data/DisplayData 2.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',[_c('el-autocomplete',{ref:\"search_input\",staticStyle:{\"width\":\"100%\"},attrs:{\"id\":\"search_input\",\"autofocus\":_vm.is_focus,\"trigger-on-focus\":false,\"suffix-icon\":_vm.search_input_icon,\"fetch-suggestions\":_vm.history_filter,\"select-when-unmatched\":\"\",\"placeholder\":\"示例：(hostname:huawei* AND price:[20000 TO 40000]) 更多请参阅Lucene语法\"},on:{\"focus\":_vm.on_focus},nativeOn:{\"keyup\":function($event){if(!('button' in $event)&&_vm._k($event.keyCode,\"enter\",13,$event.key)){ return null; }_vm.on_search()}},model:{value:(_vm.query),callback:function ($$v) {_vm.query=$$v},expression:\"query\"}},[_c('el-select',{staticStyle:{\"width\":\"250px\"},attrs:{\"slot\":\"prepend\",\"multiple\":\"\",\"filterable\":\"\",\"default-first-option\":\"\",\"placeholder\":\"选择表 默认：all\"},slot:\"prepend\",model:{value:(_vm.indices),callback:function ($$v) {_vm.indices=$$v},expression:\"indices\"}},_vm._l((_vm.tables),function(item){return _c('el-option',{key:item.id,staticStyle:{\"padding\":\"10px\",\"display\":\"flex\",\"align-items\":\"center\",\"justify-content\":\"space-between\"},attrs:{\"label\":item.name,\"value\":item.name}},[_c('span',[_vm._v(_vm._s(item.name))]),_vm._v(\" \"),_c('div',[_c('el-button',{staticStyle:{\"padding\":\"0px\"},attrs:{\"icon\":\"el-icon-circle-plus\"},on:{\"click\":function($event){$event.stopPropagation();_vm.on_add_data(item)}}}),_vm._v(\" \"),_c('el-button',{staticStyle:{\"padding\":\"0px\"},attrs:{\"icon\":\"el-icon-info\"},on:{\"click\":function($event){$event.stopPropagation();_vm.on_show_info(item)}}})],1)])})),_vm._v(\" \"),_c('el-button',{attrs:{\"slot\":\"append\",\"id\":\"submit\",\"icon\":\"el-icon-search\",\"loading\":_vm.loading},on:{\"click\":function($event){_vm.on_search()}},slot:\"append\"})],1)],1),_vm._v(\" \"),_c('div',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],staticStyle:{\"border\":\"1px #DCDFE6 solid\",\"margin\":\"10px 0px\",\"width\":\"100%\",\"overflow-x\":\"auto\"}},_vm._l((_vm.data),function(item){return _c('data-item',{key:item._id,attrs:{\"data\":item},on:{\"delete_data\":_vm.delete_data}})})),_vm._v(\" \"),_c('el-pagination',{staticStyle:{\"float\":\"right\",\"margin-right\":\"100px\"},attrs:{\"background\":\"\",\"layout\":\"total, prev, pager, next\",\"page-size\":_vm.page_size,\"total\":_vm.total_num,\"current-page\":_vm.current_page},on:{\"update:currentPage\":function($event){_vm.current_page=$event},\"current-change\":_vm.on_page_change}})],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-25baf54a\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/display-data/DisplayData 2.vue\n// module id = null\n// module chunks = ","var normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./DisplayData 2.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./DisplayData 2.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-25baf54a\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./DisplayData 2.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = null\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/display-data/DisplayData 2.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}