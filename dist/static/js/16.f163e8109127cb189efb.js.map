{"version":3,"sources":["webpack:///src/views/login/Login 2.vue","webpack:///./src/views/login/Login 2.vue?e6e8","webpack:///./src/views/login/Login 2.vue"],"names":["Login_2","ElCard","main","required","message","trigger","token","_this","this","self","username","api","post","form_data","then","response","get_user_info","catch","error","data","_this2","$c_master","get","get_next_path","next_path","Object","router","resetFields","$mount","$el","href","login_Login_2","render","_vm","_h","$createElement","_c","_self","$store","state","directives","name","rawName","value","expression","staticStyle","height","attrs","element-loading-text","width","margin","text-align","_v","color","_s","errors","non_field_errors","ref","margin-right","model","rules","title","label-width","label","prop","autofocus","nativeOn","keyup","$event","_k","keyCode","key","do_login","callback","$$v","$set","password","type","loading","submit_loading","on","click","placement","visible","size","arg","float","on_reset_password","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"iLAuCAA,eAEAC,OAAAC,EAAA,mCAGA,kBACA,sBAEA,YAEA,sBAEAC,UAAA,EAAAC,QAAA,SAAAC,QAEA,wDAEA,4BAEA,WAEA,qFAIAC,qCAIA,IAAAC,EAAAC,iBACA,+EAuBA,UACA,MArBAC,EAAAF,gBACAG,2BACA,EACAC,EAAA,EAAAC,KAAA,QAAAL,EACAM,WAAAC,KAAA,SAAAC,qBAEA,0BACAL,8CACAJ,yCAEAI,eAEAJ,UACAU,kBACAC,MAAA,SAAAC,qBAEA,sBACAC,oCAQA,IAAAC,EAAAZ,0BACA,OACAa,UAAAC,IACA,yBAAAR,KAAA,SAAAC,qBAEA,6BACAI,aACAI,+CAEA,8BAEAC,GACAC,OAAAC,EAAA,EAAAD,wBACAD,MACAP,MAAA,SAAAC,qBAEA,uDAEA,gCAGA,4DAIAS,0EAGA,oBAEAC,gCACAC,4EAGAC,uCACA,6BACA,4BACA,6BACAN,UAEA,QCrIAO,GADiBC,OAFjB,WAA0B,IAAAC,EAAAzB,KAAa0B,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAD,EAAAK,OAAAC,MAAAjC,MAAysE8B,EAAA,OAAyCI,aAAaC,KAAA,UAAAC,QAAA,YAAAC,OAAA,EAAAC,WAAA,SAAkEC,aAAeC,OAAA,QAAgBC,OAAQC,uBAAA,YAAx2EZ,EAAA,OAA2CS,aAAaI,MAAA,QAAAC,OAAA,oBAA2Cd,EAAA,WAAAA,EAAA,MAAyBS,aAAaI,MAAA,OAAAE,aAAA,YAAsClB,EAAAmB,GAAA,YAAAnB,EAAAmB,GAAA,KAAAhB,EAAA,KAAyCS,aAAaI,MAAA,OAAAE,aAAA,SAAAE,MAAA,aAAwDpB,EAAAmB,GAAAnB,EAAAqB,GAAArB,EAAAsB,OAAAC,qBAAAvB,EAAAmB,GAAA,KAAAhB,EAAA,WAA0EqB,IAAA,YAAAZ,aAA6Ba,eAAA,QAAsBX,OAAQY,MAAA1B,EAAApB,UAAA+C,MAAA3B,EAAA2B,MAAAC,MAAA,SAAAC,cAAA,UAA+E1B,EAAA,gBAAqBW,OAAOgB,MAAA,MAAAC,KAAA,WAAA9C,MAAAe,EAAAsB,OAAA7C,YAA6D0B,EAAA,YAAiBW,OAAOkB,WAAA,GAAiBC,UAAWC,MAAA,SAAAC,GAAyB,gBAAAA,IAAAnC,EAAAoC,GAAAD,EAAAE,QAAA,WAAAF,EAAAG,KAAwE,YAAetC,EAAAuC,aAAgBb,OAAQhB,MAAAV,EAAApB,UAAA,SAAA4D,SAAA,SAAAC,GAAwDzC,EAAA0C,KAAA1C,EAAApB,UAAA,WAAA6D,IAAyC9B,WAAA,yBAAkC,GAAAX,EAAAmB,GAAA,KAAAhB,EAAA,gBAAqCW,OAAOgB,MAAA,KAAAC,KAAA,WAAA9C,MAAAe,EAAAsB,OAAAqB,YAA4DxC,EAAA,YAAiBW,OAAO8B,KAAA,YAAkBX,UAAWC,MAAA,SAAAC,GAAyB,gBAAAA,IAAAnC,EAAAoC,GAAAD,EAAAE,QAAA,WAAAF,EAAAG,KAAwE,YAAetC,EAAAuC,aAAgBb,OAAQhB,MAAAV,EAAApB,UAAA,SAAA4D,SAAA,SAAAC,GAAwDzC,EAAA0C,KAAA1C,EAAApB,UAAA,WAAA6D,IAAyC9B,WAAA,yBAAkC,GAAAX,EAAAmB,GAAA,KAAAhB,EAAA,gBAAAA,EAAA,aAAqDS,aAAaI,MAAA,QAAeF,OAAQ8B,KAAA,UAAAC,QAAA7C,EAAA8C,gBAA8CC,IAAKC,MAAA,SAAAb,GAAyBnC,EAAAuC,eAAiBvC,EAAAmB,GAAA,iBAAAnB,EAAAmB,GAAA,KAAAhB,EAAA,OAAAA,EAAA,cAAiEqB,IAAA,aAAAV,OAAwBmC,UAAA,MAAAjC,MAAA,OAAgCU,OAAQhB,MAAAV,EAAA,QAAAwC,SAAA,SAAAC,GAA6CzC,EAAAkD,QAAAT,GAAgB9B,WAAA,aAAuBR,EAAA,KAAAH,EAAAmB,GAAA,kBAAAnB,EAAAmB,GAAA,KAAAhB,EAAA,OAAyDS,aAAaM,aAAA,QAAAD,OAAA,OAAmCd,EAAA,aAAkBW,OAAO8B,KAAA,UAAAO,KAAA,QAA+BJ,IAAKC,MAAA,SAAAb,GAAyBnC,EAAAkD,SAAA,MAAoBlD,EAAAmB,GAAA,cAAAnB,EAAAmB,GAAA,KAAAhB,EAAA,aAAmDI,aAAaC,KAAA,UAAAC,QAAA,uBAAA2C,IAAA,eAA+DxC,aAAeyC,MAAA,QAAevC,OAAQ8B,KAAA,UAAe5C,EAAAmB,GAAA,UAAAnB,EAAAmB,GAAA,KAAAhB,EAAA,aAA+CS,aAAayC,MAAA,SAAgBvC,OAAQ8B,KAAA,QAAcG,IAAKC,MAAAhD,EAAAsD,qBAA+BtD,EAAAmB,GAAA,uBAEjxEoC,oBCCjB,IAcAC,EAdAC,EAAA,OAcAC,CACA3F,EACA+B,GATA,EAVA,SAAA6D,GACAF,EAAA,SAaA,kBAEA,MAUAG,EAAA,QAAAJ,EAAA","file":"static/js/16.f163e8109127cb189efb.js","sourcesContent":["<template>\n  <div style=\"width: 560px; margin: 30vh auto auto;\" v-if=\"!$store.state.token\">\n    <el-card>\n      <h1 style=\"width: 100%; text-align: center\">登录CMDB</h1>\n      <p style=\"width: 100%; text-align: center; color: #f56c6c\">{{ errors.non_field_errors}}</p>\n      <el-form style=\"margin-right: 40px\" :model=\"form_data\" ref=\"form_data\" :rules=\"rules\" title=\"登录CMDB\" label-width=\"80px\">\n        <el-form-item label=\"用户名\" prop=\"username\" :error=\"errors.username\">\n          <el-input :autofocus=\"true\" @keyup.enter.native=\"do_login()\" v-model=\"form_data.username\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"密码\" prop=\"password\" :error=\"errors.password\">\n          <el-input type=\"password\" @keyup.enter.native=\"do_login()\" v-model=\"form_data.password\"></el-input>\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" style=\"width: 100%\" :loading=\"submit_loading\" @click=\"do_login()\">登 录</el-button>\n          <!--<el-button @click=\"do_reset()\">重置</el-button>-->\n        </el-form-item>\n      </el-form>\n      <div>\n        <el-popover ref=\"no_account\" placement=\"top\" width=\"160\" v-model=\"visible\">\n          <p>请联系CMDB管理员创建</p>\n          <div style=\"text-align: right; margin: 0\">\n            <el-button type=\"primary\" size=\"mini\" @click=\"visible=false\">确定</el-button>\n          </div>\n        </el-popover>\n        <el-button type=\"text\" style=\"float: left\" v-popover:no_account>没有账号</el-button>\n        <el-button type=\"text\" style=\"float: right\" @click=\"on_reset_password\">忘记密码</el-button>\n      </div>\n    </el-card>\n  </div>\n  <div v-else v-loading=\"true\" element-loading-text=\"登录中。。。\" style=\"height: 100%\">\n  </div>\n</template>\n\n<script>\nimport Vue from \"vue\";\nimport ElCard from \"element-ui/packages/card/src/main\";\nimport master from \"@/api/\";\nimport {init_router} from \"@/router\"\n\nexport default {\n  components: { ElCard },\n  data() {\n    return {\n      is_show: true,\n      submit_loading: false,\n      form_data: {\n        username: \"\",\n        password: \"\"\n      },\n      rules: {\n        username: [\n          { required: true, message: \"请输入用户名\", trigger: \"blur\" }\n        ],\n        password: [{ required: true, message: \"请输入密码\", trigger: \"blur\" }]\n      },\n      errors: {},\n      boolll: false,\n      visible: false\n    };\n  },\n  mounted() {\n    if (this.$store.state.token) {\n      this.get_user_info(this.$store.state.token);\n    }\n  },\n  methods: {\n    do_login() {\n      console.log(\"do_login\");\n      this.$refs[\"form_data\"].validate(valid => {\n        if (valid) {\n          var self = this;\n          var username = this.form_data.username;\n          this.submit_loading = true;\n          master\n            .post(\"token\", this.form_data)\n            .then(response => {\n              this.submit_loading = false;\n              console.log(\"username:\", username);\n              localStorage.setItem(\"token\", \"JWT \" + response.data.token);\n              self.$store.commit(\"login\", {\n                username: username,\n                token: response.data.token\n              });\n              this.get_user_info();\n            })\n            .catch(error => {\n              this.submit_loading = false;\n              this.errors = error.response.data;\n            });\n        } else {\n          console.log(\"false\");\n          return false;\n        }\n      });\n    },\n    get_user_info(token) {\n      this.submit_loading = true;\n      this.$c_master\n        .get(\"mgmt/user/get-my-info\")\n        .then(response => {\n          this.submit_loading = false;\n          this.$store.state.user_info = response.data;\n          var next_path = this.get_next_path();\n          if (!next_path || next_path.startsWith === \"/login\") {\n            next_path = \"/\";\n          }\n          console.log(\"next_path:\", next_path);\n          init_router()\n          this.$router.push({ path: next_path });\n        })\n        .catch(error => {\n          this.submit_loading = false;\n          if (error.response && error.response.status === 401) {\n            this.$message.error(\"会话已过期 请重新登录\");\n            return;\n          }\n          this.$message.error(\"获取用户信息失败 请重试\");\n        });\n    },\n    do_reset() {\n      this.$refs[\"form_data\"].resetFields();\n    },\n    on_reset_password() {\n      var Comp = Vue.component(\"ResetPassword\");\n      var vm = new Comp();\n      vm.$mount();\n      this.$el.appendChild(vm.$el);\n    },\n    get_next_path() {\n      console.log(\"get_next_path:\", window.location.href);\n      var l = window.location.href.split(\"next_path=\");\n      if (l.length >= 2) {\n        var next_path = l[1].split(\"&token\")[0];\n        return decodeURIComponent(next_path);\n      }\n      return null;\n    }\n  }\n};\n</script>\n\n<style scoped>\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/views/login/Login 2.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (!_vm.$store.state.token)?_c('div',{staticStyle:{\"width\":\"560px\",\"margin\":\"30vh auto auto\"}},[_c('el-card',[_c('h1',{staticStyle:{\"width\":\"100%\",\"text-align\":\"center\"}},[_vm._v(\"登录CMDB\")]),_vm._v(\" \"),_c('p',{staticStyle:{\"width\":\"100%\",\"text-align\":\"center\",\"color\":\"#f56c6c\"}},[_vm._v(_vm._s(_vm.errors.non_field_errors))]),_vm._v(\" \"),_c('el-form',{ref:\"form_data\",staticStyle:{\"margin-right\":\"40px\"},attrs:{\"model\":_vm.form_data,\"rules\":_vm.rules,\"title\":\"登录CMDB\",\"label-width\":\"80px\"}},[_c('el-form-item',{attrs:{\"label\":\"用户名\",\"prop\":\"username\",\"error\":_vm.errors.username}},[_c('el-input',{attrs:{\"autofocus\":true},nativeOn:{\"keyup\":function($event){if(!('button' in $event)&&_vm._k($event.keyCode,\"enter\",13,$event.key)){ return null; }_vm.do_login()}},model:{value:(_vm.form_data.username),callback:function ($$v) {_vm.$set(_vm.form_data, \"username\", $$v)},expression:\"form_data.username\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"密码\",\"prop\":\"password\",\"error\":_vm.errors.password}},[_c('el-input',{attrs:{\"type\":\"password\"},nativeOn:{\"keyup\":function($event){if(!('button' in $event)&&_vm._k($event.keyCode,\"enter\",13,$event.key)){ return null; }_vm.do_login()}},model:{value:(_vm.form_data.password),callback:function ($$v) {_vm.$set(_vm.form_data, \"password\", $$v)},expression:\"form_data.password\"}})],1),_vm._v(\" \"),_c('el-form-item',[_c('el-button',{staticStyle:{\"width\":\"100%\"},attrs:{\"type\":\"primary\",\"loading\":_vm.submit_loading},on:{\"click\":function($event){_vm.do_login()}}},[_vm._v(\"登 录\")])],1)],1),_vm._v(\" \"),_c('div',[_c('el-popover',{ref:\"no_account\",attrs:{\"placement\":\"top\",\"width\":\"160\"},model:{value:(_vm.visible),callback:function ($$v) {_vm.visible=$$v},expression:\"visible\"}},[_c('p',[_vm._v(\"请联系CMDB管理员创建\")]),_vm._v(\" \"),_c('div',{staticStyle:{\"text-align\":\"right\",\"margin\":\"0\"}},[_c('el-button',{attrs:{\"type\":\"primary\",\"size\":\"mini\"},on:{\"click\":function($event){_vm.visible=false}}},[_vm._v(\"确定\")])],1)]),_vm._v(\" \"),_c('el-button',{directives:[{name:\"popover\",rawName:\"v-popover:no_account\",arg:\"no_account\"}],staticStyle:{\"float\":\"left\"},attrs:{\"type\":\"text\"}},[_vm._v(\"没有账号\")]),_vm._v(\" \"),_c('el-button',{staticStyle:{\"float\":\"right\"},attrs:{\"type\":\"text\"},on:{\"click\":_vm.on_reset_password}},[_vm._v(\"忘记密码\")])],1)],1)],1):_c('div',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(true),expression:\"true\"}],staticStyle:{\"height\":\"100%\"},attrs:{\"element-loading-text\":\"登录中。。。\"}})}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-63b06840\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/login/Login 2.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-63b06840\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Login 2.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Login 2.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Login 2.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-63b06840\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./Login 2.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-63b06840\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/login/Login 2.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}