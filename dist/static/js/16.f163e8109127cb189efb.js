webpackJsonp([16],{HUCz:function(t,e){},"p+kC":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o("7+uW"),n=o("6wmS"),a=o("gyMJ"),s=o("YaEn"),i={components:{ElCard:n.a},data:function(){return{is_show:!0,submit_loading:!1,form_data:{username:"",password:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},errors:{},boolll:!1,visible:!1}},mounted:function(){this.$store.state.token&&this.get_user_info(this.$store.state.token)},methods:{do_login:function(){var t=this;console.log("do_login"),this.$refs.form_data.validate(function(e){if(!e)return console.log("false"),!1;var o=t,r=t.form_data.username;t.submit_loading=!0,a.b.post("token",t.form_data).then(function(e){t.submit_loading=!1,console.log("username:",r),localStorage.setItem("token","JWT "+e.data.token),o.$store.commit("login",{username:r,token:e.data.token}),t.get_user_info()}).catch(function(e){t.submit_loading=!1,t.errors=e.response.data})})},get_user_info:function(t){var e=this;this.submit_loading=!0,this.$c_master.get("mgmt/user/get-my-info").then(function(t){e.submit_loading=!1,e.$store.state.user_info=t.data;var o=e.get_next_path();o&&"/login"!==o.startsWith||(o="/"),console.log("next_path:",o),Object(s.b)(),e.$router.push({path:o})}).catch(function(t){e.submit_loading=!1,t.response&&401===t.response.status?e.$message.error("会话已过期 请重新登录"):e.$message.error("获取用户信息失败 请重试")})},do_reset:function(){this.$refs.form_data.resetFields()},on_reset_password:function(){var t=new(r.default.component("ResetPassword"));t.$mount(),this.$el.appendChild(t.$el)},get_next_path:function(){console.log("get_next_path:",window.location.href);var t=window.location.href.split("next_path=");if(t.length>=2){var e=t[1].split("&token")[0];return decodeURIComponent(e)}return null}}},l={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return t.$store.state.token?o("div",{directives:[{name:"loading",rawName:"v-loading",value:!0,expression:"true"}],staticStyle:{height:"100%"},attrs:{"element-loading-text":"登录中。。。"}}):o("div",{staticStyle:{width:"560px",margin:"30vh auto auto"}},[o("el-card",[o("h1",{staticStyle:{width:"100%","text-align":"center"}},[t._v("登录CMDB")]),t._v(" "),o("p",{staticStyle:{width:"100%","text-align":"center",color:"#f56c6c"}},[t._v(t._s(t.errors.non_field_errors))]),t._v(" "),o("el-form",{ref:"form_data",staticStyle:{"margin-right":"40px"},attrs:{model:t.form_data,rules:t.rules,title:"登录CMDB","label-width":"80px"}},[o("el-form-item",{attrs:{label:"用户名",prop:"username",error:t.errors.username}},[o("el-input",{attrs:{autofocus:!0},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.do_login()}},model:{value:t.form_data.username,callback:function(e){t.$set(t.form_data,"username",e)},expression:"form_data.username"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"密码",prop:"password",error:t.errors.password}},[o("el-input",{attrs:{type:"password"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.do_login()}},model:{value:t.form_data.password,callback:function(e){t.$set(t.form_data,"password",e)},expression:"form_data.password"}})],1),t._v(" "),o("el-form-item",[o("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",loading:t.submit_loading},on:{click:function(e){t.do_login()}}},[t._v("登 录")])],1)],1),t._v(" "),o("div",[o("el-popover",{ref:"no_account",attrs:{placement:"top",width:"160"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[o("p",[t._v("请联系CMDB管理员创建")]),t._v(" "),o("div",{staticStyle:{"text-align":"right",margin:"0"}},[o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){t.visible=!1}}},[t._v("确定")])],1)]),t._v(" "),o("el-button",{directives:[{name:"popover",rawName:"v-popover:no_account",arg:"no_account"}],staticStyle:{float:"left"},attrs:{type:"text"}},[t._v("没有账号")]),t._v(" "),o("el-button",{staticStyle:{float:"right"},attrs:{type:"text"},on:{click:t.on_reset_password}},[t._v("忘记密码")])],1)],1)],1)},staticRenderFns:[]};var u=o("VU/8")(i,l,!1,function(t){o("HUCz")},"data-v-63b06840",null);e.default=u.exports}});
//# sourceMappingURL=16.f163e8109127cb189efb.js.map